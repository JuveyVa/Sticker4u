<div class="container mt-5">
  <h1 class="text-center">Predictions</h1>

  <div class="row">
    <!-- Tickets -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Tickets</h5>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
              Select...
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
              <% @tickets.each do |ticket| %>
                <li>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="selected_ticket" value="<%= ticket.id %>" id="ticket_<%= ticket.id %>" onchange="console.log('Ticket seleccionado:', '<%= ticket.id %>'); loadProducts('<%= ticket.id %>')">
                    <label class="form-check-label" for="ticket_<%= ticket.id %>">
                      Ticket <%= ticket.id %> - Fecha: <%= ticket.date %>
                    </label>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla para mostrar productos -->
    <table class="table table-striped mt-3" id="products-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Sop(x)</th>
          <th>Producto relacionado</th>
          <th>Sop(x U n)</th>
          <th>% Confianza</th>
        </tr>
      </thead>
      <tbody>
        <!-- Los datos se llenan con JavaScript -->
      </tbody>
    </table>
  </div>
</div>

<script>
console.log("Script cargado correctamente");
  function loadProducts(ticketId) {
    fetch(`/predictions/tickets/${ticketId}/products`)
      .then(response => response.json())
      .then(data => {
        console.log("Datos recibidos:", data);
        const tableBody = document.querySelector("#products-table tbody");
        tableBody.innerHTML = ""; // Limpia la tabla

        data.forEach(productData => {
          productData.recommendations.forEach(rec => {
            const row = document.createElement("tr");

            row.innerHTML = `
              <td>${productData.product}</td>
              <td>${productData.sop_x}</td>
              <td>${rec.product}</td>
              <td>${rec.sop_union}</td>
              <td>${rec.confidence.toFixed(2)}%</td>
            `;

            tableBody.appendChild(row);
          });
        });
      })
      .catch(error => console.error("Error loading products:", error));
  }
</script>